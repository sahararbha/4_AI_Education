# نسخه فایل docker-compose
version: '3.8'

# تعریف سرویس‌ها (کانتینرها)
services:
  # نام سرویس دیتابیس ما 'db' است
  db:
    # استفاده از ایمیج رسمی PostgreSQL نسخه 14. 'alpine' نسخه سبک‌تر آن است.
    image: postgres:14-alpine

    # نام کانتینر در حال اجرا
    container_name: ai_platform_postgres

    # خواندن متغیرهای محیطی از فایل .env
    env_file:
      - .env

    # تعریف Volume ها برای نگهداری دائمی داده‌ها
    volumes:
      # 1. نگهداری داده‌های اصلی دیتابیس در یک volume به نام 'postgres_data'
      # حتی اگر کانتینر حذف شود، این داده‌ها باقی می‌مانند.
      - postgres_data:/var/lib/postgresql/data/

      # 2. مپ کردن اسکریپت SQL برای ساخت اولیه جداول
      # داکر به صورت خودکار تمام فایل‌های .sql در این پوشه را هنگام ساخت اولیه اجرا می‌کند.
      - ./init-db:/docker-entrypoint-initdb.d

    # مپ کردن پورت: پورت 5432 داخل کانتینر را به پورت 5432 کامپیوتر میزبان متصل کن
    # این کار به ابزارهایی مثل pgAdmin اجازه می‌دهد به دیتابیس داخل کانتینر وصل شوند.
    ports:
      - "5432:5432"

    # تنظیم سیاست راه‌اندازی مجدد
    # 'always' یعنی اگر کانتینر به هر دلیلی متوقف شد، داکر خودکار آن را دوباره اجرا کند.
    restart: always

# تعریف Volume های نام‌گذاری شده
volumes:
  postgres_data:
    # در اینجا می‌توان درایور خاصی تعریف کرد، اما حالت پیش‌فرض کافی است.